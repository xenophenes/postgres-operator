<!DOCTYPE html>
<html>
  <head>
    <title>Crunchy Data PostgreSQL Operator Documentation</title>
    
      <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="generator" content="Hugo 0.40" />

<title>Installation :: Crunchy Data PostgreSQL Operator Documentation</title>
<link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon" />
<link href="/css/nucleus.css" rel="stylesheet">
<link href="/css/font-awesome.min.css" rel="stylesheet">
<link href="/css/hybrid.css" rel="stylesheet">
<link href="/css/featherlight.min.css" rel="stylesheet">
<link href="/css/auto-complete.css" rel="stylesheet">
<link href="/theme-original/style.css" rel="stylesheet">

<link rel="stylesheet" href="/css/bootstrap.min.css">
<script src="/js/jquery-2.x.min.js"></script>
<style type="text/css">
  :root #header + #content > #left > #rlblock_left {
    display:none !important;
  }
</style>
<meta name="description" content="">


    
  </head>
  <body data-url="/installation/">
    
      <div id="headermain"></div>
<nav id="sidebar" class="">



<div class="highlightable">
  <div id="header-wrapper">
    <div id="header">
      
	
  
    <a class="baselink" href="/">Crunchy Data PostgreSQL Operator Documentation</a>
  

    </div>
        <div class="searchbox">
		    <label for="search-by"><i class="fa fa-search"></i></label>
		    <input data-search-input id="search-by" type="text" placeholder="Search...">
		    <span data-search-clear=""><i class="fa fa-close"></i></span>
		</div>
		<script type="text/javascript" src="/js/lunr.min.js"></script>
		<script type="text/javascript" src="/js/auto-complete.js"></script>
		<script type="text/javascript">
        
            var baseurl = "\/";
        
		</script>
		<script type="text/javascript" src="/js/search.js"></script>
  </div>

      <ul class="topics">
    <li data-nav-id="/configuration/" class="dd-item
        ">
      <div>
      <a href="/configuration/">Configuration</a>

      </div>
    </li>
    <li data-nav-id="/getting-started/" class="dd-item
        ">
      <div>
      <a href="/getting-started/">Getting Started</a>

      </div>
    </li>
    <li data-nav-id="/how-it-works/" class="dd-item
        ">
      <div>
      <a href="/how-it-works/">How it Works</a>

      </div>
    </li>
    <li data-nav-id="/installation/" class="dd-item parent active
        ">
      <div>
      <a href="/installation/">Installation</a>

      </div>
    </li>
    <li data-nav-id="/upgrading-the-operator/" class="dd-item
        ">
      <div>
      <a href="/upgrading-the-operator/">Upgrading the Operator</a>

      </div>
    </li>



        <section id="shortcuts">
                <li class="" role=""><h3>More</h3><a href="https://github.com/CrunchyData/postgres-operator" target="_blank" rel="noopener"><i class='fa fa-github'></i> <label>Github repo</label></a></li>
                <li class="" role=""><a href="https://github.com/CrunchyData/postgres-operator/releases/download/2.6/postgres-operator.2.6.tar.gz" target="_blank" rel="noopener"><i class='fa fa-cloud-download'></i> <label>Download</label></a></li>
                <li class="" role=""><a href="https://kubernetes.io/docs/" target="_blank" rel="noopener"><i class='fa fa-bookmark'></i> <label>Kubernetes Documentation</label></a></li>
        </section>

    <hr />
    <li></li>

    </ul>

 <section id="footer">
    </section>
  </div>
</nav>



<section id="body">
<div id="overlay"></div>
<div class="padding highlightable">

  <div id="top-bar">
    
      
      
      
    <div id="top-github-link">
      <a class="github-link" href="https://github.com/crunchydata/postgres-operatorinstallation/_index.adoc" target="blank">
        <i class="fa fa-code-fork"></i>
        Improve this page
      </a>
    </div><div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
        <span id="sidebar-toggle-span">
          <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
            <i class="fa fa-bars"></i>
          </a>
        </span>
        <span id="toc-menu"><i class="fa fa-list-alt"></i></span>
        <span class="links">
        




 <a href='/'>Crunchy Data PostgreSQL Operator</a> > Installation




        </span>
    </div>

    
    <div class="progress">
        <div class="wrapper">
    
        </div>
    </div>
    

  </div>


<div id="body-inner">
  
    <h1>Installation</h1>
  



    
    
    

<div class="paragraph">
<p>v2.6, 2018-04-25</p>
</div>
<div class="paragraph">
<div class="expand">
    <div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fa fa-chevron-down' : 'fa fa-chevron-right';});});">
        <i style="font-size:x-small;" class="fa fa-chevron-right"></i>
        <span>
        
        
        Quick Installation
        
        </span>
    </div>
    <div class="expand-content" style="display: none;">
<div class="sect1">
<h2 id="_overview">Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are currently <strong>quickstart</strong> scripts that seek to automate
the deployment to popular Kube environments -</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/CrunchyData/postgres-operator/blob/master/examples/quickstart-for-gke.sh">quickstart-for-gke.sh</a></p>
</li>
<li>
<p><a href="https://github.com/CrunchyData/postgres-operator/blob/master/examples/quickstart-for-ocp.sh">quickstart-for-ocp.sh</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <strong>quickstart-for-gke</strong> script will deploy the operator to
a GKE Kube cluster.</p>
</div>
<div class="paragraph">
<p>The <strong>quickstart-for-ocp</strong> script will deploy the operator to
an Openshift Container Platform cluster.</p>
</div>
<div class="paragraph">
<p>Both scripts assume you have a StorageClass defined for persistence.</p>
</div>
<div class="paragraph">
<p>Pre-compiled versions of the Operator <strong>pgo</strong> client are provided for the x86_64, Mac OSX, and Windows hosts.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_quickstart">Quickstart</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_gke_pks">GKE/PKS</h3>
<div class="paragraph">
<p>The <strong>quickstart-for-gke.sh</strong> script will allow users to set up the Postgres Operator quickly on GKE including PKS.
This script is tested on GKE but can be modified for use with other Kubernetes environments as well.</p>
</div>
<div class="paragraph">
<p>The script requires a few things in order to work -</p>
</div>
<div class="ulist">
<ul>
<li>
<p>wget utility installed</p>
</li>
<li>
<p>kubectl utility installed</p>
</li>
<li>
<p>StorageClass defined</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Executing the script will give you a default Operator deployment
that assumes <strong>dynamic</strong> storage and a storage class named <strong>standard</strong>,
things that GKE provides.</p>
</div>
<div class="paragraph">
<p>The script performs the following -</p>
</div>
<div class="ulist">
<ul>
<li>
<p>downloads the Operator configuration files</p>
</li>
<li>
<p>sets the $HOME/.pgouser file to default settings</p>
</li>
<li>
<p>deploys the Operator Deployment</p>
</li>
<li>
<p>sets your .bashrc to include the Operator environment variables</p>
</li>
<li>
<p>sets your $HOME/.bash_completion file to be the <strong>pgo</strong> bash_completion file</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_openshift_container_platform">Openshift Container Platform</h3>
<div class="paragraph">
<p>A similar script for installing the operator on OCP is
offered with similar features as the GKE script.  This script is
tested on OCP 3.7 with a StorageClass defined.</p>
</div>
</div>
</div>
</div>

    </div>
</div>
</div>
<div class="paragraph">
<p><div class="expand">
    <div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fa fa-chevron-down' : 'fa fa-chevron-right';});});">
        <i style="font-size:x-small;" class="fa fa-chevron-right"></i>
        <span>
        
        
        Manual Installation
        
        </span>
    </div>
    <div class="expand-content" style="display: none;">
<div class="sect1">
<h2 id="_project_structure">Project Structure</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To perform an installation of the operator, first create the project structure as follows on your host, here we assume a local directory called <strong>odev</strong> -</p>
</div>
<div class="literalblock">
<div class="content">
<pre>export GOPATH=$HOME/odev
mkdir -p $HOME/odev/src $HOME/odev/bin $HOME/odev/pkg
mkdir -p $GOPATH/src/github.com/crunchydata/</pre>
</div>
</div>
<div class="paragraph">
<p>Next, get a tagged release of the source code -</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cd $GOPATH/src/github.com/crunchydata
git clone https://github.com/CrunchyData/postgres-operator.git
cd postgres-operator
git checkout 2.6</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation_prerequsites">Installation Prerequsites</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To run the operator and the <strong>pgo</strong> client, you will need the following -</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a running Kubernetes or OpenShift cluster</p>
</li>
<li>
<p>the kubectl or oc clients installed in your PATH and configured to connect to the cluster (e.g. export KUBECONFIG=/etc/kubernetes/admin.conf)</p>
</li>
<li>
<p>a Kubernetes namespace created and set to where you want the operator installed. For this install we assume a namespace of <strong>demo</strong> has been created.</p>
</li>
</ul>
</div>
<div class="literalblock">
<div class="content">
<pre>kubectl create -f examples/demo-namespace.json
kubectl config set-context $(kubectl config current-context) --namespace=demo
kubectl config view | grep namespace</pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you are not using the <strong>demo</strong> namespace, it will be required to edit the following and change the namespace where the service account and cluster role bindings will be deployed.</p>
</div>
<div class="paragraph">
<p><code>$COROOT/deploy/service-account.yaml</code></p>
</div>
<div class="paragraph">
<p><code>$COROOT/deploy/cluster-role-binding.yaml</code></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Permissions are granted to the Operator by means of a Service Account called <strong>postgres-operator</strong>.  That service account is added to the Operator deployment.</p>
</div>
<div class="paragraph">
<p>The postgres-operator service account is granted cluster-admin priviledges using a cluster role binding <strong>postgres-operator-cluster-role-binding</strong>.</p>
</div>
<div class="paragraph">
<p>See <a href="https://kubernetes.io/docs/admin/authorization/rbac/">here</a> for more details on how to enable RBAC roles and modify the scope of the permissions to suit your needs.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_basic_installation">Basic Installation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The basic installation uses the default operator configuration settings, these settings assume you want to use HostPath storage on your Kube cluster for database persistence.  Other persistent options are available but require the Advanced Installation below.</p>
</div>
<div class="sect2">
<h3 id="_create_hostpath_directory">Create HostPath Directory</h3>
<div class="paragraph">
<p>The default Persistent Volume script assumes a default HostPath directory be created called <strong>/data</strong>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>sudo mkdir /data
sudo chown 777 /data</pre>
</div>
</div>
<div class="paragraph">
<p>Create some sample Persistent Volumes using the following script:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>export CO_NAMESPACE=demo
export CO_CMD=kubectl
export COROOT=$GOPATH/src/github.com/crunchydata/postgres-operator
go get github.com/blang/expenv
$COROOT/pv/create-pv.sh</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_build_images_deploy">Build Images &amp; Deploy</h2>
<div class="sectionbody">
<div class="paragraph">
<p>&lt;div class="expand"&gt;
    &lt;div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fa fa-chevron-down' : 'fa fa-chevron-right';});});"&gt;
        &lt;i style="font-size:x-small;" class="fa fa-chevron-right"&gt;&lt;/i&gt;
        &lt;span&gt;</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Packaged Images</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>        &lt;/span&gt;
    &lt;/div&gt;
    &lt;div class="expand-content" style="display: none;"&gt;
&lt;div class="sect2"&gt;
&lt;h3 id="_packaged_images"&gt;Packaged Images&lt;/h3&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;To pull prebuilt versions from Dockerhub of the &lt;strong&gt;postgres-operator&lt;/strong&gt; containers, specify the image versions, and execute the following Makefile target -&lt;/p&gt;
&lt;/div&gt;
&lt;div class="literalblock"&gt;
&lt;div class="content"&gt;
&lt;pre&gt;export CO_IMAGE_PREFIX=crunchydata
export CO_IMAGE_TAG=centos7-2.6
make pull&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;To pull down the prebuilt &lt;strong&gt;pgo&lt;/strong&gt; binaries, download the &lt;strong&gt;tar.gz&lt;/strong&gt; release file from the following link -&lt;/p&gt;
&lt;/div&gt;
&lt;div class="ulist"&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href="https://github.com/CrunchyData/postgres-operator/releases"&gt;Github Releases&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;extract (e.g. tar xvzf postgres-operator.2.6-rc1.tar.gz)&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="literalblock"&gt;
&lt;div class="content"&gt;
&lt;pre&gt;cd $HOME
tar xvzf ./postgres-operator.2.6-rc1.tar.gz&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="ulist"&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;copy &lt;strong&gt;pgo&lt;/strong&gt; client to somewhere in your path (e.g. cp pgo /usr/local/bin)&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;Next, deploy the operator to your Kubernetes cluster -&lt;/p&gt;
&lt;/div&gt;
&lt;div class="literalblock"&gt;
&lt;div class="content"&gt;
&lt;pre&gt;cd $COROOT
make deployoperator&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>    &lt;/div&gt;
&lt;/div&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;div class="expand"&gt;
    &lt;div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fa fa-chevron-down' : 'fa fa-chevron-right';});});"&gt;
        &lt;i style="font-size:x-small;" class="fa fa-chevron-right"&gt;&lt;/i&gt;
        &lt;span&gt;</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Build from Source</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>        &lt;/span&gt;
    &lt;/div&gt;
    &lt;div class="expand-content" style="display: none;"&gt;
&lt;div class="sect2"&gt;
&lt;h3 id="_build_from_source"&gt;Build from Source&lt;/h3&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;The purpose of this section is to illustrate how to build the PostgreSQL
Operator from source. These are considered advanced installation steps and
should be primarily used by developers or those wishing a more precise
installation method.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="sect3"&gt;
&lt;h4 id="_requirements"&gt;Requirements&lt;/h4&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;The postgres-operator runs on any Kubernetes and Openshift platform that supports
Custom Resource Definitions. The Operator is tested on Kubeadm and OpenShift
Container Platform environments.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;The operator is developed with the Golang versions greater than or equal to version 1.8. See
&lt;a href="https://golang.org/dl/"&gt;Golang website&lt;/a&gt; for details on installing golang.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;The Operator project builds and operates with the following containers -&lt;/p&gt;
&lt;/div&gt;
&lt;div class="ulist"&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href="https://hub.docker.com/r/crunchydata/pgo-lspvc/"&gt;PVC Listing Container&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href="https://hub.docker.com/r/crunchydata/pgo-rmdata/"&gt;Remove Data Container&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href="https://hub.docker.com/r/crunchydata/postgres-operator/"&gt;postgres-operator Container&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href="https://hub.docker.com/r/crunchydata/pgo-apiserver/"&gt;apiserver Container&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href="https://hub.docker.com/r/crunchydata/pgo-load/"&gt;file load Container&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;This Operator is developed and tested on the following operating systems but is known to run on other operating systems -&lt;/p&gt;
&lt;/div&gt;
&lt;div class="ulist"&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;CentOS 7&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;RHEL 7&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;First, install the project library dependencies. The godep dependency manager is used for this purpose. -&lt;/p&gt;
&lt;/div&gt;
&lt;div class="literalblock"&gt;
&lt;div class="content"&gt;
&lt;pre&gt;cd $COROOT
make setup&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;Then, compile the PostgreSQL Operator using the Makefile.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="literalblock"&gt;
&lt;div class="content"&gt;
&lt;pre&gt;cd $COROOT
make all
which pgo&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;Finally, deploy the operator to your Kubernetes cluster.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="literalblock"&gt;
&lt;div class="content"&gt;
&lt;pre&gt;cd $COROOT
make deployoperator&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>    &lt;/div&gt;
&lt;/div&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;div class="expand"&gt;
    &lt;div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fa fa-chevron-down' : 'fa fa-chevron-right';});});"&gt;
        &lt;i style="font-size:x-small;" class="fa fa-chevron-right"&gt;&lt;/i&gt;
        &lt;span&gt;</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Makefile Targets</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>        &lt;/span&gt;
    &lt;/div&gt;
    &lt;div class="expand-content" style="display: none;"&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_makefile_targets"&gt;Makefile Targets&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;The following table describes the Makefile targets:
.Makefile Targets&lt;/p&gt;
&lt;/div&gt;
&lt;table class="tableblock frame-topbot grid-all" style="width: 80%;"&gt;
&lt;colgroup&gt;
&lt;col style="width: 50%;"&gt;
&lt;col style="width: 50%;"&gt;
&lt;/colgroup&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th class="tableblock halign-left valign-top"&gt;Target&lt;/th&gt;
&lt;th class="tableblock halign-left valign-top"&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td class="tableblock halign-left valign-top"&gt;&lt;p class="tableblock"&gt;all&lt;/p&gt;&lt;/td&gt;
&lt;td class="tableblock halign-left valign-top"&gt;&lt;p class="tableblock"&gt;compile all binaries and build all images&lt;/p&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class="tableblock halign-left valign-top"&gt;&lt;p class="tableblock"&gt;setup&lt;/p&gt;&lt;/td&gt;
&lt;td class="tableblock halign-left valign-top"&gt;&lt;p class="tableblock"&gt;fetch the dependent packages required to build with&lt;/p&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class="tableblock halign-left valign-top"&gt;&lt;p class="tableblock"&gt;deployoperator&lt;/p&gt;&lt;/td&gt;
&lt;td class="tableblock halign-left valign-top"&gt;&lt;p class="tableblock"&gt;deploy the Operator (apiserver and postgers-operator) to Kubernetes&lt;/p&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class="tableblock halign-left valign-top"&gt;&lt;p class="tableblock"&gt;main&lt;/p&gt;&lt;/td&gt;
&lt;td class="tableblock halign-left valign-top"&gt;&lt;p class="tableblock"&gt;compile the postgres-operator&lt;/p&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class="tableblock halign-left valign-top"&gt;&lt;p class="tableblock"&gt;runmain&lt;/p&gt;&lt;/td&gt;
&lt;td class="tableblock halign-left valign-top"&gt;&lt;p class="tableblock"&gt;locally execute the postgres-operator&lt;/p&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class="tableblock halign-left valign-top"&gt;&lt;p class="tableblock"&gt;pgo&lt;/p&gt;&lt;/td&gt;
&lt;td class="tableblock halign-left valign-top"&gt;&lt;p class="tableblock"&gt;build the pgo binary&lt;/p&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class="tableblock halign-left valign-top"&gt;&lt;p class="tableblock"&gt;runpgo&lt;/p&gt;&lt;/td&gt;
&lt;td class="tableblock halign-left valign-top"&gt;&lt;p class="tableblock"&gt;run the pgo binary&lt;/p&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class="tableblock halign-left valign-top"&gt;&lt;p class="tableblock"&gt;runapiserver&lt;/p&gt;&lt;/td&gt;
&lt;td class="tableblock halign-left valign-top"&gt;&lt;p class="tableblock"&gt;run the apiserver binary outside of Kube&lt;/p&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class="tableblock halign-left valign-top"&gt;&lt;p class="tableblock"&gt;clean&lt;/p&gt;&lt;/td&gt;
&lt;td class="tableblock halign-left valign-top"&gt;&lt;p class="tableblock"&gt;remove binaries and compiled packages, restore dependencies&lt;/p&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class="tableblock halign-left valign-top"&gt;&lt;p class="tableblock"&gt;operatorimage&lt;/p&gt;&lt;/td&gt;
&lt;td class="tableblock halign-left valign-top"&gt;&lt;p class="tableblock"&gt;compile and build the postgres-operator Docker image&lt;/p&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class="tableblock halign-left valign-top"&gt;&lt;p class="tableblock"&gt;apiserverimage&lt;/p&gt;&lt;/td&gt;
&lt;td class="tableblock halign-left valign-top"&gt;&lt;p class="tableblock"&gt;compile and build the apiserver Docker image&lt;/p&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class="tableblock halign-left valign-top"&gt;&lt;p class="tableblock"&gt;lsimage&lt;/p&gt;&lt;/td&gt;
&lt;td class="tableblock halign-left valign-top"&gt;&lt;p class="tableblock"&gt;build the lspvc Docker image&lt;/p&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class="tableblock halign-left valign-top"&gt;&lt;p class="tableblock"&gt;loadimage&lt;/p&gt;&lt;/td&gt;
&lt;td class="tableblock halign-left valign-top"&gt;&lt;p class="tableblock"&gt;build the file load Docker image&lt;/p&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class="tableblock halign-left valign-top"&gt;&lt;p class="tableblock"&gt;rmdataimage&lt;/p&gt;&lt;/td&gt;
&lt;td class="tableblock halign-left valign-top"&gt;&lt;p class="tableblock"&gt;build the data deletion Docker image&lt;/p&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class="tableblock halign-left valign-top"&gt;&lt;p class="tableblock"&gt;release&lt;/p&gt;&lt;/td&gt;
&lt;td class="tableblock halign-left valign-top"&gt;&lt;p class="tableblock"&gt;build the postgres-operator release&lt;/p&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>    &lt;/div&gt;
&lt;/div&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;div class="expand"&gt;
    &lt;div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fa fa-chevron-down' : 'fa fa-chevron-right';});});"&gt;
        &lt;i style="font-size:x-small;" class="fa fa-chevron-right"&gt;&lt;/i&gt;
        &lt;span&gt;</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Helm Chart</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>        &lt;/span&gt;
    &lt;/div&gt;
    &lt;div class="expand-content" style="display: none;"&gt;
&lt;div class="sect2"&gt;
&lt;h3 id="_helm_chart"&gt;Helm Chart&lt;/h3&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;First, pull prebuilt versions from Dockerhub of the &lt;strong&gt;postgres-operator&lt;/strong&gt; containers,
specify the image versions, and execute the following Makefile target -&lt;/p&gt;
&lt;/div&gt;
&lt;div class="literalblock"&gt;
&lt;div class="content"&gt;
&lt;pre&gt;export CO_IMAGE_PREFIX=crunchydata
export CO_IMAGE_TAG=centos7-2.6
make pull&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;Then, build and deploy the operator using the provided Helm chart -&lt;/p&gt;
&lt;/div&gt;
&lt;div class="literalblock"&gt;
&lt;div class="content"&gt;
&lt;pre&gt;cd $COROOT/chart
helm install ./postgres-operator
helm ls&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>    &lt;/div&gt;
&lt;/div&gt;</pre>
</div>
</div>
<div class="sect2">
<h3 id="_verify_operator_status">Verify Operator Status</h3>
<div class="paragraph">
<p>To verify that the operator is deployed and running, run the following:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>kubectl get pod --selector=name=postgres-operator</pre>
</div>
</div>
<div class="paragraph">
<p>You should see output similar to this:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>NAME                                 READY     STATUS    RESTARTS   AGE
postgres-operator-56598999cd-tbg4w   2/2       Running   0          1m</pre>
</div>
</div>
<div class="paragraph">
<p>There are 2 containers in the operator pod, both should be <strong>ready</strong> as above.</p>
</div>
<div class="paragraph">
<p>When you first run the operator, it will create the required
CustomResourceDefinitions. You can view these as follows -</p>
</div>
<div class="literalblock">
<div class="content">
<pre>kubectl get crd</pre>
</div>
</div>
<div class="paragraph">
<p>The operator creates the following Custom Resource Definitions over time as the
associated commands are triggered.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>kubectl get crd
NAME                             AGE
pgbackups.cr.client-go.k8s.io    2d
pgclusters.cr.client-go.k8s.io   2d
pgingests.cr.client-go.k8s.io    2d
pgpolicies.cr.client-go.k8s.io   2d
pgreplicas.cr.client-go.k8s.io   2d
pgtasks.cr.client-go.k8s.io      2d
pgupgrades.cr.client-go.k8s.io   2d</pre>
</div>
</div>
<div class="paragraph">
<p>At this point, the server side of the operator is deployed and ready.</p>
</div>
<div class="paragraph">
<p>The complete set of environment variables used in the installation
so far are -</p>
</div>
<div class="literalblock">
<div class="content">
<pre>export CO_IMAGE_PREFIX=crunchydata
export CO_IMAGE_TAG=centos7-2.6
export GOPATH=$HOME/odev
export GOBIN=$GOPATH/bin
export PATH=$PATH:$GOBIN
export COROOT=$GOPATH/src/github.com/crunchydata/postgres-operator
export CO_CMD=kubectl</pre>
</div>
</div>
<div class="paragraph">
<p>You would normally add these into your <strong>.bashrc</strong> at this point to be used later on or if you want to redeploy the operator.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configure_strong_pgo_strong_client">Configure <strong>pgo</strong> Client</h3>
<div class="paragraph">
<p>The <strong>pgo</strong> command line client requires TLS for securing the connection to the operator&#8217;s REST API.  This configuration is performed as follows:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>export PGO_CA_CERT=$COROOT/conf/apiserver/server.crt
export PGO_CLIENT_CERT=$COROOT/conf/apiserver/server.crt
export PGO_CLIENT_KEY=$COROOT/conf/apiserver/server.key</pre>
</div>
</div>
<div class="paragraph">
<p>The <strong>pgo</strong> client uses Basic Authentication to authenticate to the operator REST API, for authentication, add the following <strong>.pgouser</strong> file to your $HOME:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>echo "username:password" &gt; $HOME/.pgouser</pre>
</div>
</div>
<div class="paragraph">
<p>The <strong>pgo</strong> client needs the URL to connect to the operator.</p>
</div>
<div class="paragraph">
<p>Depending on your Kube environment this can be done the following ways:</p>
</div>
<div class="sect3">
<h4 id="_running_kube_locally">Running Kube Locally</h4>
<div class="paragraph">
<p>If your local host is not set up to resolve Kube Service DNS names, you can specify the operator IP address as follows:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>kubectl get service postgres-operator
NAME                TYPE       CLUSTER-IP     EXTERNAL-IP   PORT(S)          AGE
postgres-operator   NodePort   10.109.184.8   &lt;none&gt;        8443:30894/TCP   5m

export CO_APISERVER_URL=https://10.109.184.8:8443
pgo version</pre>
</div>
</div>
<div class="paragraph">
<p>You can also define a bash alias like:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>alias setip='export CO_APISERVER_URL=https://`kubectl get service postgres-operator -o=jsonpath="{.spec.clusterIP}"`:8443'</pre>
</div>
</div>
<div class="paragraph">
<p>This alias will set the CO_APISERVER_URL IP address for you!</p>
</div>
</div>
<div class="sect3">
<h4 id="_running_kube_remotely">Running Kube Remotely</h4>
<div class="paragraph">
<p>Set up a port-forward tunnel from your host to the Kube remote host, specifying the operator pod:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>kubectl get pod --selector=name=postgres-operator
NAME                                 READY     STATUS    RESTARTS   AGE
postgres-operator-56598999cd-tbg4w   2/2       Running   0          8m

kubectl port-forward postgres-operator-56598999cd-tbg4w 8443:8443</pre>
</div>
</div>
<div class="paragraph">
<p>In another terminal:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>export CO_APISERVER_URL=https://127.0.0.1:8443
pgo version</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_verify_strong_pgo_strong_client">Verify <strong>pgo</strong> Client</h3>
<div class="paragraph">
<p>At this point you should be able to connect to the operator as follows:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>pgo version
pgo client version 2.6
apiserver version 2.6</pre>
</div>
</div>
<div class="paragraph">
<p><strong>pgo</strong> commands are documented on the <a href="/getting-started/">Getting Started</a> page.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_storage_configuration">Storage Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Most users after they try out the operator will want to create a more customized installation and deployment of the operator using specific storage types.</p>
</div>
<div class="paragraph">
<p>The operator will work with HostPath, NFS, Dynamic, and GKE Storage.</p>
</div>
<div class="sect2">
<h3 id="_nfs">NFS</h3>
<div class="paragraph">
<p>To configure the operator to use NFS for storage, a sample <strong>pgo.yaml.nfs</strong> file is provided.  Overlay the default <strong>pgo.yaml</strong> file with that file:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cp $COROOT/examples/pgo.yaml.nfs $COROOT/conf/apiserver/pgo.yaml</pre>
</div>
</div>
<div class="paragraph">
<p>Edit the <strong>pgo.yaml</strong> file to specify the NFS GID that is set for the NFS volume mount you will be using, the default value assumed is <strong>nfsnobody</strong> as the GID (65534).  Update the value to meet your NFS security settings.</p>
</div>
<div class="paragraph">
<p>There is currently no script available to create your NFS Persistent Volumes but you can typically modify the $COROOT/pv/create-pv.sh script to work with NFS.</p>
</div>
</div>
<div class="sect2">
<h3 id="_dynamic">Dynamic</h3>
<div class="paragraph">
<p>To configure the operator to use Dynamic Storage classes for storage, a sample <strong>pgo.yaml.storageclass</strong> file is provided.  Overlay the default <strong>pgo.yaml</strong> file with that file:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cp $COROOT/examples/pgo.yaml.storageclass $COROOT/conf/apiserver/pgo.yaml</pre>
</div>
</div>
<div class="paragraph">
<p>Edit the <strong>pgo.yaml</strong> file to specify the storage class you will be using, the default value assumed is <strong>standard</strong> which is the name used by default within a GKE Kube cluster deployment.  Update the value to match your storage classes.</p>
</div>
<div class="paragraph">
<p>Notice that the <strong>FsGroup</strong> setting is required for most block storage and is set to the value of <strong>26</strong> since the PostgreSQL container runs as UID <strong>26</strong>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_gke">GKE</h3>
<div class="paragraph">
<p>Some notes for setting up GKE for the Operator deployment.</p>
</div>
<div class="sect3">
<h4 id="_install_kubectl">Install Kubectl</h4>
<div class="paragraph">
<p>On your host you will be working from, install the kubectl command:</p>
</div>
<div class="paragraph">
<p><a href="https://kubernetes.io/docs/tasks/tools/install-kubectl/" class="bare">https://kubernetes.io/docs/tasks/tools/install-kubectl/</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_gcp">GCP</h4>
<div class="ulist">
<ul>
<li>
<p>Select your project</p>
</li>
<li>
<p>Create a Kube cluster in that project</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By default a storage class called <strong>standard</strong> is created.</p>
</div>
</div>
<div class="sect3">
<h4 id="_install_gcloud">Install GCloud</h4>
<div class="paragraph">
<p>To access the Kube cluster you need to install the gcloud utility:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>https://cloud.google.com/sdk/downloads
cd google-cloud-sdk
./install.sh</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_configure_kubectl_for_cluster_access">Configure Kubectl for Cluster Access</h4>
<div class="literalblock">
<div class="content">
<pre>gcloud auth login

gcloud container clusters get-credentials jeff-quickstart --zone us-central1-a --project crunchy-dev-test

kubectl get storageclass</pre>
</div>
</div>
</div>
</div>
</div>
</div>

    </div>
</div></p>
</div>
<div class="paragraph">
<p><div class="expand">
    <div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fa fa-chevron-down' : 'fa fa-chevron-right';});});">
        <i style="font-size:x-small;" class="fa fa-chevron-right"></i>
        <span>
        
        
        I&#39;ve installed the Operator. Now what?
        
        </span>
    </div>
    <div class="expand-content" style="display: none;">
<div class="sect1">
<h2 id="_next_steps">Next Steps</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are many ways to configure the operator further. Some sample configurations are
documented on the <a href="/configuration/">Configuration</a> page.</p>
</div>
<div class="paragraph">
<p>You may also want to find out more information on how the operator is designed to work and
deploy. This information can be found in the <a href="/how-it-works/">How It Works</a> page.</p>
</div>
<div class="paragraph">
<p>Information can be found on the full scope of commands on the
<a href="/getting-started/">Getting Started</a> page.</p>
</div>
</div>
</div>

    </div>
</div></p>
</div>



    
    
          <footer class=" footline" >
	
</footer>
  </div>
</div>

<div id="navigation">
<a class="nav nav-prev" href="/upgrading-the-operator/" title="Upgrading the Operator"> <i class="fa fa-chevron-left"></i><label>Upgrading the Operator</label></a>
    <a class="nav nav-next" href="/configuration/" title="Configuration" style="margin-right: 0px;"><label>Configuration</label><i class="fa fa-chevron-right"></i></a></div>

</section>
<div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
  <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
</div>    

<script src="/js/clipboard.min.js"></script>
<script src="/js/featherlight.min.js"></script>
<script src="/js/html5shiv-printshiv.min.js"></script>

<script src="/js/modernizr.custom.71422.js"></script>
<script src="/js/docdock.js"></script>
<script src="/theme-original/script.js"></script>


    

    
    

    
  </body>
</html>